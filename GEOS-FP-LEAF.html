<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Dashboard</title>

    <!-- Leaflet and Plotly -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Copy the style block from HRRR-SMOKE.html below -->
    <style>
         html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background-color: rgba(241, 156, 53, 0.6);
    color: #333;
}

.main-container {
    position: relative;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
}

.top-row {
    position: relative;
    height: 100%;
    width: 100%;
}

#map-container {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    z-index: 1;
}

#map2 {
    height: 100%;
    width: 100%;
}

.leaflet-control-attribution {
    display: none !important;
}

#aq-indicator-map {
    position: absolute;
    top: 80px;
    left: -10px;
    z-index: 1000;
    background: none;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 10px 16px;
    flex-direction: column;
    align-items: flex-start;
    min-width: 180px;
    max-width: 90vw;
    display: none;
}

#sidebar {
    position: absolute;
    top: 0;
    right: 0;
    width: 330px;
    height: 70vh; /* Shorter than full height */
    overflow-y: auto; /* Enables vertical scrolling */
    overflow-x: hidden; /* Prevents horizontal scroll */
    z-index: 10;
    padding: 20px;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
    border-left: none;
    display: flex;
    flex-direction: column;
    gap: 20px;
    border-radius: 8px 0 0 8px;
    background: rgba(241, 156, 53, 0.6);
}


#bottom-section {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
    background: rgba(241, 156, 53, 0.6);
    padding: 10px 16px;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
}

label {
    display: inline-block;
    margin-right: 12px;
    font-size: 14px;
}

#place-title {
    font-size: 2rem;
    font-weight: 600;
    background-color: #eef6fc;
    padding: 12px 16px;
    border-left: 4px solid #007acc;
    border-radius: 6px;
    word-break: break-word;
}

#graph {
    flex: 1 1 200px;
    min-height: 180px;
    max-height: 220px;
    height: 200px;
    width: 100%;
    margin-bottom: 10px;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#forecast-time {
    font-size: 1rem;
    color: #444;
    padding: 8px 0;
    font-weight: bolder;
}

#search-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

#search-input {
    flex: 1 1 120px;
    min-width: 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
}

#search-btn {
    padding: 10px 16px;
    border: none;
    background-color: #007acc;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-size: 1rem;
}

#search-btn:hover {
    background-color: #005fa3;
}

#top-banner {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: auto;
    min-width: 200px;
    max-width: 80vw;
    background: rgba(241, 156, 53, 0.6);
    color: #000;
    font-size: 1.1rem;
    font-weight: bold;
    padding: 6px 20px;
    border-radius: 0 0 8px 8px;
    text-align: center;
    z-index: 2000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#aq-indicator-info {
    font-size: 1.1rem;
    font-weight: bold;
    background: #eef6fc;
    border-left: 4px solid #007acc;
    border-radius: 6px;
    padding: 8px 14px;
    margin-bottom: 8px;
    display: inline-block;
}

#aq-indicator {
    font-weight: bolder;
}

#aq-indicator span {
    border: 2px solid black;
}

#search-error {
    margin-top: 5px;
    color: #d9534f;
    font-size: 13px;
}

#layer-slider-container {
    display: flex;
    align-items: center;
    width: 100%;
    box-sizing: border-box;
    gap: 0;
}

.slider-track-wrap {
    flex: 1 1 0;
    min-width: 0;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

#layer-slider {
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    display: block;
}

#slider-ticks {
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 12px;
    color: #444;
    font-weight: bolder;
    user-select: none;
    pointer-events: none;
    position: relative;
    left: 0;
    margin-top: 2px;
    margin-bottom: 0;
    box-sizing: border-box;
}

#slider-ticks span {
    flex: 1 1 0;
    text-align: center;
    white-space: nowrap;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0;
}

#sources {
    font-size: 12px;
}

button {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 10px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.2s ease;
}

button:hover {
    background-color: #005fa3;
}

.legend {
    position: fixed; /* Or absolute, if it needs to be inside a relative container */
    left: 0;
    bottom: 200px; /* keep this or adjust depending on where you want it vertically */
    background: rgba(255, 255, 255, 0.9);
    padding: 10px;
    font-size: 14px;
    color: #444;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}


#info-popup {
    display: none;
    position: fixed;
    z-index: 4000;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    color: #222;
    border-radius: 10px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.25);
    padding: 24px 18px 18px 18px;
    max-width: 100vw;
    max-height: 80vh;
    overflow-y: auto;
}

#close-info-popup {
    position: absolute;
    top: 8px;
    right: 12px;
    background: none;
    border: none;
    font-size: 2rem;
    color: #007acc;
    cursor: pointer;
    z-index: 4100;
}

.legend h4 {
    margin: 0 0 10px;
    font-size: 16px;
    text-align: center;
}

.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

#aq-indicator-map.collapsed #aq-indicator-info,
#aq-indicator-map.collapsed #aq-indicator {
    display: none;
}

#aq-indicator-map .legend-toggle,
.legend-toggle {
    background: blue;
    border: none;
    font-size: 1.2em;
    cursor: pointer;
    padding: 0 6px;
    line-height: 1;
}

.legend-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    margin-bottom: 6px;
}

#mobile-bottom-bar {
    display: none;
}

@media (max-width: 900px) {
  #layer-slider, #slider-ticks {
    display: none;
  }

  .slider-track-wrap {
    flex: none;
    width: auto;
  }

  #layer-slider-container {
    justify-content: space-between;
  }

  #bottom-section {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }

  #bottom-section button {
    flex: 1 1 auto;
    margin: 4px;
  }
  #sidebar {
    display: none;
  }
}

    </style>
</head>

<body>
    <div id="top-banner"></div>
    <div class="main-container">
        <div class="top-row">
            <div id="map-container" style="position:relative; flex:2;">
                <div id="map2"></div>
                <div id="aq-indicator-map">
                    <button id="aq-indicator-toggle" class="legend-toggle" type="button" aria-label="Collapse AQ Info">âˆ’
                    </button>
                    <div id="aq-indicator-info">Click a location to view averages.</div>
                    <div id="aq-indicator"><span style="background:#eee;padding:6px 16px;border-radius:6px;">No data</span>
                    </div>
                </div>
            </div>
            <div id="sidebar">
                <div id="place-title"></div>
                <div id="graph" style="display:none;"></div>
                <div id="forecast-time"></div>
                <div id="search-container">
                    <input type="text" id="search-input" placeholder="Search for a place..." />
                    <button id="search-btn">Search</button>
                    <div id="search-error"></div>
                </div>
                <div id="info-section">
                    <p><b>*This feature currently does not support clicks. Updates including values returned on click and time-series graph will be added soon.</b><br></p>
                    <p>This web application has been developed for the visualization of GEOS model predictions for Air Quality readings. Use the map to view any location and click to view model values. You can also
                        use the slider or arrows at the bottom of the page to see the forecasted progression of Air Quality over the next 48 hours. <br>
                        Use the search bar to lookup a location. <b>Warning: only locations covered by the satellite swath
                            will return values.</b> </p>
                    <div id="sources">
                        <p>The GEOS data used have been provided by the Global Modeling and Assimilation Office (GMAO) at
                            NASA Goddard Space Flight Center through the online data portal in the NASA Center for Climate
                            Simulation by the Mao Lab and provided as a web service by the Geographic Information Network of
                            Alaska (GINA).</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="bottom-section">
            <div id="layer-slider-container">
                <button id="prev-frame" title="Previous">&#8592;</button>
                <div class="slider-track-wrap">
                    <input type="range" id="layer-slider" min="1" max="14" value="1">
                    <div id="slider-ticks"></div>
                </div>
                <button id="next-frame" title="Next">&#8594;</button>
                <button id="play-pause" title="Play/Pause">Play</button>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>
    <script src="geos-fp-leaf.js"></script>
    <!-- Mobile-only bottom bar -->
    <div id="mobile-bottom-bar">
        <button id="mobile-prev-frame" title="Previous">&#8592;</button>
        <button id="mobile-play-pause" title="Play/Pause">Play</button>
        <button id="mobile-next-frame" title="Next">&#8594;</button>
        <button id="mobile-info-btn" title="Info">Info</button>
    </div>
    <div id="info-popup">
        <button id="close-info-popup" aria-label="Close">&times;</button>
        <div id="info-popup-content">
            <!-- Move the content of #info-section here -->
            <p>This web application has been developed for the visualization of HRRR model predictions for visibility
                and PM2.5 readings. Use the map to view any location and click to view model values. You can also use
                the slider or arrows at the bottom of the page to see the forecasted progression of smoke and
                visibility over the next 48 hours. <br>
                Use the search bar to lookup a location. <b>Warning: only locations covered by the satellite swath
                    will return values.</b> </p>
            <div id="sources">
                <p>The GEOS data used have been provided by the Global Modeling and Assimilation Office (GMAO) at
                    NASA Goddard Space Flight Center through the online data portal in the NASA Center for Climate
                    Simulation by the Mao Lab and provided as a web service by the Geographic Information Network of
                    Alaska (GINA).</p>
            </div>
        </div>
    </div>
    <script>
        // aq indicator div (once we have pixel vals)
    </script>
</body>

</html>
